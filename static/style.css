/* --- Base Styles --- */
:root {
    --dark-bg: #212529;
    --dark-card-bg: #2b3035;
    --dark-border: #444;
    --primary-color: #6a5acd; /* ラベンダー */
    --today-color: #a1882d; /* 彩度を抑えた黄色 */
    --dot-color: #b89b4b;
    /* --- 習慣カレンダー用フォント --- */
    --font-penco-header: 'Roboto Condensed', sans-serif;
    --font-penco-day: 'Playpen Sans', cursive;
    --font-penco-sticker: 'Playpen Sans', cursive; /* シール用も指定 */
    /* --- ★カレンダー背景色 --- */
    --calendar-bg: #FAF8F0; /* 少しアイボリー寄りの白 */
}

body {
    background-color: var(--dark-bg);
    color: #f8f9fa;
    padding-top: 56px;
    padding-bottom: 80px; /* スマホフッター分 */
}

.card {
    background-color: var(--dark-card-bg);
    border: 1px solid var(--dark-border);
    border-radius: 0.5rem;
}

/* --- Header & Layout --- */
.main-container {
    padding-top: 20px;
}
/* Navbar Offcanvas Link styling */
.offcanvas .nav-link {
    color: rgba(255, 255, 255, 0.65);
    transition: color .15s ease-in-out, background-color .15s ease-in-out; /* 背景色もトランジション */
}
/* ★ホバー色を調整 */
.offcanvas .nav-link:hover, .offcanvas .nav-link:focus,
.offcanvas form .btn-link.nav-link:hover {
    color: rgba(255, 255, 255, 0.95); /* 文字色を少し明るく */
    background-color: rgba(255, 255, 255, 0.1); /* 背景を薄く白く */
}
.offcanvas .nav-link.active {
    color: #fff;
    font-weight: bold;
    background-color: rgba(var(--bs-warning-rgb), 0.2); /* 例: 習慣カレンダーは薄い黄色 */
}
/* サイドバーの習慣カレンダーボタンのホバー */
.sidebar-left .nav-link.btn-warning:hover {
    background-color: rgba(var(--bs-warning-rgb), 0.25); /* 少し濃く */
    color: var(--bs-warning);
    border-color: rgba(var(--bs-warning-rgb), 0.5);
}


/* Make button look like nav-link */
.offcanvas form .btn-link.nav-link {
    text-decoration: none;
    padding: var(--bs-nav-link-padding-y) var(--bs-nav-link-padding-x);
    font-size: var(--bs-nav-link-font-size);
    font-weight: var(--bs-nav-link-font-weight);
    color: rgba(255, 255, 255, 0.65);
     background: none;
    border: none;
}


/* --- Auth & Flash Messages --- */
.auth-form {
    padding-top: 5vh;
}

.flash-messages {
    position: fixed;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    z-index: 1050;
    width: 90%;
    max-width: 500px;
}

/* --- Layout: Sidebars & Main Content --- */
.sidebar-left, .sidebar-right {
    height: calc(100vh - 56px); /* Adjust height considering fixed navbar */
    position: sticky;
    top: 56px; /* Stick below the navbar */
    overflow-y: auto;
    padding-top: 20px;
}

.sidebar-title {
    font-size: 1.5rem;
    margin-bottom: 1.5rem;
    padding-left: 0.75rem;
}

.sidebar-left .scratchpad-btn {
    background-color: #6c757d;
    color: white;
    border-color: #6c757d;
}
.sidebar-left .scratchpad-btn:hover {
    background-color: #5a6268;
    border-color: #545b62;
}


.main-content {
    border-left: 1px solid var(--dark-border);
    border-right: 1px solid var(--dark-border);
    min-height: calc(100vh - 56px);
}

/* --- Header inside Main Content --- */
.date-nav .btn {
    margin: 0 5px;
}

/* --- Offline Toggle Switch Styles --- */
.offline-switch-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
    padding: 8px;
    background-color: var(--dark-card-bg);
    border-radius: 0.5rem;
    border: 1px solid var(--dark-border);
}

/* --- Grid Section --- */
.grid-section .card {
    background-color: rgba(0,0,0,0.2);
    display: flex;
    justify-content: center;
    align-items: center;
}

.grid-wrapper {
    width: 100%;
    /* Responsive padding */
    padding: 0 max(10px, calc(100% / (var(--cols, 10) + 2)));
    box-sizing: border-box;
}

.new-grid-container {
    display: grid;
    grid-template-columns: repeat(var(--cols, 10), 1fr);
    /* grid-auto-rows: 1fr; Remove fixed row height based on width */
    width: 100%;
    gap: 2px;
}

.grid-cell {
    width: 100%;
    aspect-ratio: 1 / 1;
    background-color: #343a40;
    box-sizing: border-box;
}

.grid-cell.task-area {
    outline: 1px solid #777;
    outline-offset: -1px;
}

.grid-cell.completed {
    background-color: var(--primary-color);
    outline-color: var(--primary-color);
}

/* --- Task List --- */
.list-group-item {
    background-color: transparent;
    border-color: var(--dark-border) !important;
}

.sub-task.completed {
    text-decoration: line-through;
    color: #888;
}

/* Completed icon style */
.sub-task .complete-toggle {
    color: #ced4da; /* Default icon color */
    transition: color 0.2s ease-in-out;
}
.sub-task.completed .complete-toggle {
    color: var(--primary-color); /* Color when completed */
}
.sub-task .complete-toggle:hover {
    color: #fff; /* Hover color */
}


.diff-days {
    font-weight: bold;
    color: #ffc107;
}

.master-task-card.all-completed {
    opacity: 0.5; /* 少し濃くする */
    transition: opacity 0.3s ease-in-out;
}
.master-task-card.all-completed:hover {
    opacity: 1;
}

/* --- Focus Mode & Urgent Task Styles --- */
.task-title-clickable {
    cursor: pointer;
    transition: color 0.2s ease-in-out;
}
.task-title-clickable:hover {
    color: #a991f7;
}

.task-title-clickable.text-urgent,
.task-title-clickable.text-urgent .text-muted {
    color: #e57373 !important; /* 目に優しい赤 */
}
.task-title-clickable.text-urgent:hover {
    color: #ef9a9a !important; /* ホバー時の少し明るい赤 */
}
/* Recurring task icons */
.task-title-clickable .bi-arrow-repeat,
.task-title-clickable .bi-calendar-week {
    font-size: 0.9em;
    margin-right: 0.2em;
    color: #adb5bd; /* Slightly muted color */
}


.modal-content {
    background-color: var(--dark-card-bg);
    border: 1px solid var(--dark-border);
}

.modal-header {
    border-bottom: 1px solid var(--dark-border);
}

.modal-body .list-group-item {
    background-color: transparent;
    border-color: var(--dark-border) !important;
}

.modal-backdrop.show {
    opacity: 0.95;
}

/* --- Right Sidebar: Calendar --- */
.calendar-card .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.4rem 0.8rem;
}

.calendar-card .card-body {
    padding: 0.1rem;
}

.calendar-table {
    width: 100%;
    table-layout: fixed;
    border-spacing: 2px;
    border-collapse: separate;
}

.calendar-table th {
    text-align: center;
    font-weight: normal;
    font-size: 0.7rem;
    color: #888;
    padding-bottom: 0.2rem;
}

.calendar-table td {
    text-align: center;
    padding: 0;
    vertical-align: top;
}

.calendar-table td a {
    display: block;
    width: 100%;
    aspect-ratio: 1 / 0.8;
    border-radius: 4px;
    text-decoration: none;
    color: #f8f9fa;
    transition: background-color 0.2s;
    background-color: #343a40;
    position: relative;
    overflow: hidden; /* ドットがはみ出ないように */
}

.calendar-table td a:hover {
    background-color: #495057;
}

.calendar-table td.current-date a {
    background-color: var(--primary-color);
    color: white;
    font-weight: bold;
}

.calendar-table td.today a .calendar-day-num {
    color: var(--today-color);
    font-weight: bold;
}

.calendar-table td.today.current-date a {
    box-shadow: none;
}

.calendar-table td.today.current-date a .calendar-day-num {
    color: white;
}

.calendar-day-num {
    position: absolute;
    top: 2px;
    left: 4px;
    font-size: 0.55rem;
}

/* Task dots grid layout */
.task-dots {
    position: absolute;
    bottom: 2px; /* Adjust spacing from bottom */
    left: 50%;
    transform: translateX(-50%);
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 columns */
    gap: 1px; /* Adjust gap between dots */
    width: calc(4 * 3px + 3 * 1px); /* Calculate width based on dot size and gap */
    max-width: 80%; /* Ensure it doesn't overflow */
}

.task-dot {
    display: block;
    width: 3px;
    height: 3px;
    background-color: var(--dot-color);
    border-radius: 50%;
}

.calendar-table td.current-date .task-dot {
    background-color: white;
}

/* --- Right Sidebar: Summary --- */
.progress-circle {
    width: 120px;
    height: 120px;
    border-radius: 50%;
    background: conic-gradient(var(--primary-color) var(--progress, 0%), #444 0);
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 10px auto;
    position: relative;
    transition: background 0.5s;
}

.progress-circle::before {
    content: '';
    position: absolute;
    width: 85%;
    height: 85%;
    background: var(--dark-card-bg);
    border-radius: 50%;
}

.progress-text {
    z-index: 1;
    font-size: 1.5rem;
    font-weight: bold;
}

/* --- Mobile Bottom Navigation --- */
.d-md-none.navbar {
    border-top: 1px solid var(--dark-border);
    padding: 0.5rem 0;
}
.d-md-none.navbar .btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.75rem;
    padding: 0.25rem 0.5rem;
}
.d-md-none.navbar .btn i {
    font-size: 1.25rem;
    margin-bottom: 2px; /* アイコンと文字の間 */
}
.d-md-none.navbar .scratchpad-btn-mobile {
    color: #adb5bd;
}


/* --- Responsive Styles --- */
@media (max-width: 767px) {
    body {
        padding-top: 56px;
        padding-bottom: 70px; /* Adjust if footer nav height changes */
    }
    .main-container {
        padding-top: 10px; /* Reduce top padding on mobile */
    }
    .main-content {
        border-left: none;
        border-right: none;
    }
    .sidebar-left, .sidebar-right {
        position: static;
        height: auto;
        overflow-y: visible;
        padding-top: 10px;
        border-bottom: 1px solid var(--dark-border); /* Add separator */
    }
    .main-content {
         border-top: 1px solid var(--dark-border); /* Add separator */
    }
    .sidebar-sticky { position: static; } /* Override sticky on mobile */
}


/* --- Loading Overlay --- */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(33, 37, 41, 0.85); /* 半透明のダーク背景 */
    display: none; /* 初期状態では非表示 */
    justify-content: center;
    align-items: center;
    flex-direction: column;
    z-index: 9999;
    backdrop-filter: blur(5px); /* 背景をぼかす */
}

/* --- ▼▼▼ 習慣カレンダー (habit_calendar.html) 用スタイル ▼▼▼ --- */

/* ★ページ全体のレイアウト調整 (PC) */
@media (min-width: 992px) { /* lg breakpoint */
    .habit-calendar-page .row {
        flex-wrap: nowrap; /* 横並びにする */
    }
    .habit-calendar-page .habit-calendar-col {
        flex: 1 1 70%; /* カレンダーを広く */
        max-width: 70%;
    }
     .habit-calendar-page .sticker-palette-col {
        flex: 1 1 30%; /* シール台紙を狭く */
        max-width: 30%;
        position: sticky; /* スクロールしても追従 */
        top: 76px; /* Navbarの下 */
        height: calc(100vh - 96px); /* 高さを調整 */
        overflow-y: auto; /* シールが多い場合にスクロール */
    }
}

.habit-calendar-page h2,
.habit-calendar-page h3 {
    font-family: var(--font-penco-header); /* 見出し用フォント */
}

/* ★カード全体にダークテーマに合わせた枠線を追加 */
.habit-calendar-card {
    border: 3px solid var(--dark-border);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.habit-calendar-card .card-header {
    font-family: var(--font-penco-header);
    font-size: 1.5rem; /* YYYY年 MM月 のサイズ */
    background-color: #e9ecef; /* ヘッダー背景を少し明るく */
    color: #333; /* 文字色 */
    border-bottom: 2px solid #ced4da; /* 区切り線 */
}
.habit-calendar-card .card-header button {
    font-size: 1.5rem;
    line-height: 1;
    color: #555; /* ボタンの色 */
}
.habit-calendar-card .card-header button:hover {
    color: #000;
}


.penco-calendar {
    background-color: var(--calendar-bg); /* ★CSS変数を使用 */
    color: #333333; /* 基本文字色 */
    padding: 10px;
    border: none; /* カード側で枠線をつけるので不要に */
    user-select: none;
}

.penco-calendar .weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-family: var(--font-penco-header);
    font-size: 0.75rem;
    font-weight: 700;
    color: #6c757d; /* 曜日ヘッダーの色 */
    padding-bottom: 5px;
    border-bottom: 1px solid #dee2e6; /* 薄い区切り線 */
    margin-bottom: 5px;
}
.penco-calendar .weekdays .text-primary { color: #0d6efd !important; }
.penco-calendar .weekdays .text-danger { color: #dc3545 !important; }

.penco-calendar .days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px; /* ★日付間の隙間を少し広げる */
}

.penco-calendar .day {
    position: relative;
    border: 1px solid #e9ecef;
    min-height: 80px; /* 日付セルの最小高さ */
    padding: 4px;
    display: flex;
    flex-direction: column;
    align-items: flex-start; /* 左上に日付番号 */
    background-color: #fff; /* 通常の日付背景 */
     transition: background-color 0.2s ease-out; /* ハイライト用 */
}

.penco-calendar .day.empty {
    background-color: transparent; /* 空セル背景を透明に */
    border: none;
}

.penco-calendar .day-number {
    font-family: var(--font-penco-day);
    font-size: 1.7rem; /* Penco風の大きな数字、少し調整 */
    font-weight: 600; /* 少し太く */
    line-height: 1;
    margin-bottom: 5px;
    color: #555; /* 数字の色を少し濃く */
    z-index: 1; /* シールより手前に */
    position: relative;
}
.penco-calendar .day.saturday .day-number { color: #0d6efd; } /* 土曜日の数字色 */
.penco-calendar .day.sunday .day-number { color: #dc3545; } /* 日曜日の数字色 */
.penco-calendar .day.today .day-number {
     background-color: #ffc107; /* 今日の日付マーカー */
     color: #333;
     border-radius: 50%;
     width: 28px;
     height: 28px;
     display: inline-flex;
     align-items: center;
     justify-content: center;
     font-size: 1.1rem; /* マーカー内数字サイズ調整 */
     box-shadow: 0 0 5px rgba(255, 193, 7, 0.5); /* マーカーに少し影 */
}

/* シールコンテナ */
.stickers-container {
    position: absolute; /* 日付番号の上に重ねる */
    top: 30px; /* 日付番号の下あたりから開始 */
    left: 4px;
    right: 4px;
    bottom: 4px;
    display: flex;
    flex-wrap: wrap;
    gap: 3px; /* シール間の隙間 */
    padding-top: 2px;
    align-content: flex-start; /* 上から詰める */
    /* ★スマホでのシール表示改善 */
    max-height: calc(100% - 32px); /* 最大高さを制限 */
    overflow-y: auto; /* 多数の場合スクロール (見た目調整必要かも) */
}
/* スマホ用シールサイズ調整 */
@media (max-width: 576px) {
    .stickers-container {
        gap: 2px;
    }
}


/* シール本体 */
.sticker {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-penco-sticker);
    font-weight: 700;
    font-size: 0.9rem;
    color: white;
    text-shadow: 1px 1px 1px rgba(0,0,0,0.3); /* 文字に影 */
    box-shadow: inset 0 -2px 2px rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.4); /* 立体感 */
    cursor: grab;
    position: relative;
    transition: transform 0.1s ease-out, box-shadow 0.1s ease-out;
    border: 1px solid rgba(0,0,0,0.2); /* 輪郭を少し強調 */
}
/* スマホ用シールサイズ */
@media (max-width: 576px) {
    .sticker {
        width: 18px;
        height: 18px;
        font-size: 0.7rem;
    }
}


/* シール台紙のシール */
#sticker-sheet .sticker {
     cursor: grab;
     transition: opacity 0.2s ease-out, transform 0.1s ease-out;
}
#sticker-sheet .sticker:active {
    cursor: grabbing;
    transform: scale(1.1);
    box-shadow: 0 4px 8px rgba(0,0,0,0.4);
}
/* ★使用済み（カレンダーに貼られた）シールの見た目 */
#sticker-sheet .sticker.used {
    opacity: 0.4 !important; /* 透明度を下げる */
    cursor: default;
    pointer-events: none; /* ドラッグ不可に */
}

/* ドラッグ中の半透明シール（Body直下） */
.sticker.dragging {
    pointer-events: none; /* ドロップ先のイベントを妨げない */
    position: absolute;
    opacity: 0.7;
    transform: scale(1.1) rotate(-5deg);
    box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    z-index: 1000;
}


/* シールの頭文字 */
.sticker-initial {
    line-height: 1;
}

/* シール目印（薄いシール） */
.sticker.placeholder {
    opacity: 0.15; /* ★さらに薄く */
    box-shadow: none;
    cursor: default;
    border: 1px dashed rgba(0, 0, 0, 0.4); /* ★枠線を少し濃く */
    background-color: rgba(180, 180, 180, 0.5) !important; /* 背景色固定 */
    pointer-events: none; /* ドラッグ操作を邪魔しない */
}
.sticker.placeholder .sticker-initial { display: none; }

/* ドロップ先のハイライト */
.penco-calendar .day.drag-over {
    background-color: rgba(106, 90, 205, 0.1); /* ラベンダー色で薄くハイライト */
    border-color: var(--primary-color);
}
/* ★ドロップ不可な場所のスタイル (JSで制御) */
.penco-calendar .day.no-drop {
    cursor: not-allowed;
}
.penco-calendar .day.drag-over.no-drop {
    background-color: rgba(220, 53, 69, 0.1); /* 赤色で薄くハイライト */
    border-color: #dc3545;
}


/* シール台紙 */
.sticker-palette.card {
     background-color: var(--calendar-bg); /* ★カレンダーと同じ背景色 */
     border: 3px solid var(--dark-border); /* ★カレンダーと統一感のある枠線 */
     color: #333; /* 文字色 */
}
.sticker-palette .card-header {
    background-color: #e9ecef; /* ヘッダー背景 */
    border-bottom: 2px solid #ced4da;
}
#sticker-sheet {
    min-height: 100px; /* 少し高さを確保 */
    padding: 10px;
}
#no-habits-message {
    color: #6c757d; /* メッセージの色 */
}

/* --- ▲▲▲ 習慣カレンダー用スタイル ▲▲▲ --- */

